<main class="body">

  <div class="container">
    <div class="row">
      <div class="col-6">

        <!-----------Options -->
        <div class=" bg-light p-3">
          <div class="row">
            <div class="col-1">
              <img src="{{getImageForID('cerenovus')}}" (error)="onImageError($event,'cerenovus')"
                style="height: 60px; position:relative; top:3px">
            </div>
            <div class="col-11">
              <h1 class="ScriptName fs-1" style="padding-top:20px; color:maroon;">Madness Script Maker
              </h1>
            </div>
          </div>
          <div class="row">
            <div class="col-12 mb-3">
              <h5 class="card-title fs-3">Input JSON</h5>
            </div>
            <div class="col mb-3">
              <input type="file" id="formFile" class="custom-file-input form-control" accept=".json"
                (change)="onFileSelected($event)" />
            </div>
          </div>
          <div class="row">
            <div class="col-8">
              <textarea type="text" class="form-control" [(ngModel)]="jsonInput" (ngModelChange)="create()" rows="4"
                cols="50" placeholder="Input script JSON"></textarea>
            </div>
            <div class="col-4">
              <div class="row">
                <button class="btn btn-secondary mb-3 btn-lg" (click)="paste()">Paste JSON</button>
              </div>

              <div class="row">
                <button class="btn btn-primary btn-lg" [useExistingCss]="true" printSectionId="print-section"
                  ngxPrint>Save & Print</button>
              </div>
            </div>
          </div>

          <!-------------------->
          <img src="divider.png" style="height:1px; width:100%" class="mt-3">


          <div class="row mt-4">
            <div class="col">
              <h5 class="card-title fs-3">Images</h5>
            </div>
          </div>
          <div class="row mt-2 mb-3">
            <div class="col-5">
              <select [(ngModel)]="imageSelection" (ngModelChange)="imageOverwrite()" class="form-select fs-4">
                <option>SVG</option>
                <option>PNG</option>
                <option>Custom</option>
              </select>
            </div>
            @if(imageSelection == 'Custom'){
            <div class="col-7">
              <textarea type="text" [(ngModel)]="imageOverwriteText" (ngModelChange)="imageOverwrite()"
                placeholder="Custom image URL" rows="1" class="form-control fs-4"></textarea>
            </div>
            }
          </div>
          @if(imageSelection == 'Custom'){
          <div class="row">
            <div class="col-12">
              <div class="alert alert-primary" role="alert">
                Add a link to custom character images with {{'{'}}id{{'}'}} for the character id (ex pithag, lilmonsta).
                <br><br>Example:

                <i>
                  https://raw.githubusercontent.com/tomozbot/botc-icons/refs/heads/main/SVG/{{'{'}}id{{'}'}}.svg

                </i>
              </div>
            </div>
          </div>
          }


          


          <!--------------Options-->
          <img src="divider.png" style="height:1px; width:100%">

          <div class="row mt-3 mb-3">
            <div class="col">
              <h5 class="card-title fs-3">Options</h5>
            </div>
          </div>
          <div class="row mt-2 mb-3">
            <div class="col-8">
              <label class="form-check-label fs-4 mt-1" for="showBoot">Title Font Size (default 34px):</label>
            </div>
            <div class="col-4">
              <textarea type="text" [(ngModel)]="scriptFontSize" (ngModelChange)="imageOverwrite()"
                placeholder="Custom image URL" rows="1" class="form-control fs-4"></textarea>
            </div>

          </div>
          <div class="row">
            <div class="col-7">
              <label class="form-check-label fs-4 mt-1" for="showBoot">Stormcaught Character:</label>
            </div>
            <div class="col-5">

              <select [(ngModel)]="stormcaught" (ngModelChange)="create()" class="form-select fs-4"
                title="Stormcaught Character">
                <option>none</option>
                @for(char of characters; track char){

                <option>
                  {{ char }}
                </option>
                }
              </select>

            </div>

          </div>
          <div class="col">
            <div class="form-check form-switch ps-5 mt-3">
              <input class="form-check-input fs-5" type="checkbox" id="showBoot" [(ngModel)]="showBoot"
                (ngModelChange)="create()">
              <label class="form-check-label fs-4" for="showBoot">Show Bootlegger rules on script page (if any)</label>
            </div>
          </div>

          <div class="col">
            <div class="form-check form-switch ps-5 mt-3">
              <input class="form-check-input fs-5" type="checkbox" id="showDjinn" [(ngModel)]="showDjinn"
                (ngModelChange)="create()">
              <label class="form-check-label fs-4" for="showDjinn">Show Djinn on script page</label>
            </div>
          </div>

          <div class="col">
            <div class="form-check form-switch ps-5 mt-3">
              <input class="form-check-input fs-5" type="checkbox" id="npcNames" [(ngModel)]="showNpcNames"
                (ngModelChange)="create()">
              <label class="form-check-label fs-4" for="npcNames">Show NPC names on script page</label>
            </div>
          </div>

                    <div class="col">
            <div class="form-check form-switch ps-5 mt-3">
              <input class="form-check-input fs-5" type="checkbox" id="invertOtherNight" [(ngModel)]="invertOther"
                (ngModelChange)="create()">
              <label class="form-check-label fs-4" for="invertOtherNight">Invert other night order</label>
            </div>
          </div>

          <div class="col">
            <div class="form-check form-switch ps-5 mt-3">
              <input class="form-check-input fs-5" type="checkbox" id="invertOtherNight" [(ngModel)]="showPlayerCount"
                (ngModelChange)="create()">
              <label class="form-check-label fs-4" for="showPlayerCount">Show player count</label>
            </div>
          </div>

          <div class="col">
            <div class="form-check form-switch ps-5 mt-3">
              <input class="form-check-input fs-5" type="checkbox" id="invertOtherNight" [(ngModel)]="showCharBottom"
                (ngModelChange)="create()">
              <label class="form-check-label fs-4" for="showPlayerCount">Show character icons on bottom of 2nd page</label>
            </div>
          </div>

          <!------------------------------->
          <img src="divider.png" style="height:1px; width:100%" class="mt-3">
          <div class="row mt-3 mb-2">
            <div class="col">
              <h5 class="card-title fs-3">Colors</h5>
            </div>
          </div>
          <div class="row mb-3 mt-3">
            <div class="col-6">
              <label class="form-check-label fs-4">Script Name:</label>
            </div>
            <div class="col-6">
              <input [(colorPicker)]="scriptNameColor" [style.background]="scriptNameColor"
                [cpPresetColors]="['#000000', '#800000']" (change)="create()" />

            </div>
          </div>
          <div class="row mt-2">
            <div class="col-6">
              <label class="form-check-label fs-4">Good Color:</label>
            </div>
            <div class="col-6">
              <input [(colorPicker)]="goodCharColor" [style.background]="goodCharColor"
                [cpPresetColors]="['#000000', '#0b6aaf', '#0000ff' ]" (change)="create()" />
            </div>
            <div class="col-6">
              <label class="form-check-label fs-4">Evil Color:</label>
            </div>
            <div class="col-6">
              <input [(colorPicker)]="evilCharColor" [style.background]="evilCharColor"
                [cpPresetColors]="['#000000', '#760A0D', '#ff0000' ]" (change)="create()" />
            </div>
            <div class="col-6">
              <label class="form-check-label fs-4">Fabled Color:</label>
            </div>
            <div class="col-6">
              <input [(colorPicker)]="fabledColor" [style.background]="fabledColor"
                [cpPresetColors]="['#000000', '#7a6550', '#aa9e00ff' ]" (change)="create()" />
            </div>
            <div class="col-6">
              <label class="form-check-label fs-4">Loric Color:</label>
            </div>
            <div class="col-6">
              <input [(colorPicker)]="loricColor" [style.background]="loricColor"
                [cpPresetColors]="['#000000', '#6f854d', '#8ac729ff' ]" (change)="create()" />
            </div>
            <div class="col-6">
              <label class="form-check-label fs-4">Traveller Color:</label>
            </div>
            <div class="col-6">
              <input [(colorPicker)]="travColor" [style.background]="travColor"
                [cpPresetColors]="['#000000', '#500050', '#bd00bdff' ]" (change)="create()" />
            </div>



          </div>
          <div class="row mt-3">
            <div class="col-2">
              <button class="btn btn-secondary" (click)="blackColors()">Black</button>
            </div>
            <div class="col-2">
              <button class="btn btn-secondary" (click)="resetColors()">Dark</button>
            </div>
            <div class="col-2">
              <button class="btn btn-secondary" (click)="lightColors()">Light</button>
            </div>

          </div>

          <div class="col-12 mt-5">
            <div class="alert alert-secondary" role="alert">
              PDF Preview may not be fully accurate, click the Save & Print Button to view the final version. Print with
              A4 paper size.
            </div>
            <div class="col-12">
              <div class="alert alert-secondary" role="alert">
                Unofficial character art from <a href="https://github.com/tomozbot/botc-icons">Tomozbot's Github</a>
              </div>
            </div>

            <div class="alert alert-secondary" role="alert">
              Created by @Thomas04 on the Unoffical BOTC Discord. <br>Not endorsed by TPI.
              <br>
              Source Code: <a href="https://github.com/tap0119/ScriptMaker">https://github.com/tap0119/ScriptMaker</a>

            </div>

          </div>
        </div>
      </div>


      <div class="col-6">


        @if(jsonError && jsonInput){
        <div class="row">
          <div class="col-12">
            <div class="alert alert-danger fs-4" role="alert">
              Error! Incorrect json input
            </div>
          </div>
        </div>

        }

        <!----------Print--------------------------------------------------------->

        <div id="print-section">

          <!---- Page 1 --->
          <div class="print-page">
            @if(jsonInput){
            <div class="page1">

              <div class="page1header">
                <div class="HeaderRow">
                  <!----NPCs-->
                  <div style="padding-right:15px; padding-bottom:10px; position: relative; 
        top: 6px;">

                    @if(npcs.length > 3) {
                    <p class="npcNamePage1" style="padding-left:7px; padding-right:7px;"><b>+ {{npcs.length -
                        3}}</b>
                    </p>
                    }

                    @if (npcs[2]) {
                    @if(showNpcNames){
                    @if (npcs[2].Team === 'loric') {
                    <p class="npcNamePage1" [style.color]='loricColor'>{{npcs[2].Name}}</p>
                    }@else{

                    <p class="npcNamePage1" [style.color]='fabledColor'>{{npcs[2].Name}}</p>
                    }
                    }
                    <img src={{npcs[2].Image}} class="imagenpc" (error)="onImageError($event,npcs[2].ID)">
                    }

                    @if (npcs[1]) {
                    @if(showNpcNames){
                    @if (npcs[1].Team === 'loric') {
                    <p class="npcNamePage1" [style.color]='loricColor'>{{npcs[1].Name}}</p>
                    }@else{

                    <p class="npcNamePage1" [style.color]='fabledColor'>{{npcs[1].Name}}</p>
                    }
                    }
                    <img src={{npcs[1].Image}} class="imagenpc" (error)="onImageError($event,npcs[1].ID)">
                    }


                    @if (npcs[0]) {
                    @if(showNpcNames){
                    @if (npcs[0].Team === 'loric') {
                    <p class="npcNamePage1" [style.color]='loricColor'>{{npcs[0].Name}}</p>
                    }@else{

                    <p class="npcNamePage1" [style.color]='fabledColor'>{{npcs[0].Name}}</p>
                    }
                    }
                    <img src={{npcs[0].Image}} class="imagenpc" (error)="onImageError($event,npcs[0].ID)">
                    }
                  </div>


                  <!----Name and Author-->
                  <div class="d-flex">
                    <div class="ScriptName" [style.color]="scriptNameColor" [style.font-size]="scriptFontSize">
                      {{scriptName}}
                    </div>

                    @if (author){
                    <div class="Author" [style.color]="scriptNameColor">
                      <div class="AuthorText">
                      <i>by {{author}}</i>
                      </div>
                    </div>
                    }


                  </div>
                </div>

                <!-----Bootlegger row page 1-->
                @if (bootlegger.length > 0 && showBoot){
                <div class="bootleggerPage1Div">
                  <div class="bootleggerPage1Image">
                    <img src="{{getImageForID('bootlegger')}}" (error)="onImageError($event,'bootlegger')" height="60">
                  </div>


                  @for (rule of bootlegger; track rule){
                  <div class="bootleggerPage1Row">
                    <b style="padding-right: 60px;"></b>
                    <p>⦁</p>
                    <p class="bootleggerRule">{{ rule }}</p>
                  </div>
                  }
                </div>
                }
              </div>

              <div class="page1main" [style.height]="page1height">
                <!-- Townsfolk -->
                <div class="divRow">
                  <div class="divider">
                    <img src="divider.png" class="divPng">
                  </div>
                  <div class="TypeHeader">TOWNSFOLK</div>
                </div>


                @for (item of townsfolkPage1; track item) {
                <div class="charRow" style="float: left;">
                  <div class="charImageContainer">
                    <img src={{item.Image}} class="charImage" (error)="onImageError($event,item.ID)">
                  </div>
                  <div class="chartextrow">
                    <div class="charnamerow">
                      <b class="charname" [style.color]='goodCharColor'>{{ item.Name }}</b>
                      @for (jinx of filteredJinxes; track jinx){
                      @if (jinx.char1 === item.ID){
                      @if (getImageForID(jinx.char2)) {
                      <img src={{getImageForID(jinx.char2)}} class="jinxIcon" (error)="onImageError($event,jinx.char2)">
                      }
                      }
                      }
                    </div>
                    <p class="charability" [style.line-height]="abilityLineHeight">{{item.Ability}}</p>
                  </div>
                </div>
                }



                <!-- Outsiders -->
                <div class="divRow">
                  <div class="divider">
                    <img src="divider.png" class="divPng">
                  </div>
                  <div class="TypeHeader">OUTSIDERS</div>
                </div>

                @for (item of outsidersPage1; track item) {
                <div class="charRow">
                  <div class="charImageContainer">
                    <img src={{item.Image}} class="charImage" (error)="onImageError($event,item.ID)">
                  </div>
                  <div class="chartextrow">
                    <div class="charnamerow">
                      <b class="charname" [style.color]='goodCharColor'>{{ item.Name }}</b>
                      @for (jinx of filteredJinxes; track jinx){
                      @if (jinx.char1 === item.ID){
                      @if (getImageForID(jinx.char2)) {
                      <img src={{getImageForID(jinx.char2)}} class="jinxIcon" (error)="onImageError($event,jinx.char2)">
                      }
                      }
                      }
                    </div>
                    <p class="charability" [style.line-height]="abilityLineHeight">{{item.Ability}}</p>

                  </div>
                </div>
                }


                <!-- Minions -->
                <div class="divRow">
                  <div class="divider">
                    <img src="divider.png" class="divPng">
                  </div>
                  <div class="TypeHeader">MINIONS</div>
                </div>

                @for (item of minionsPage1; track item) {
                <div class="charRow">
                  <div class="charImageContainer">
                    <img src={{item.Image}} class="charImage" (error)="onImageError($event,item.ID)">
                  </div>
                  <div class="chartextrow">
                    <div class="charnamerow">
                      <b class="charname" [style.color]='evilCharColor'>{{ item.Name }}</b>
                      @for (jinx of filteredJinxes; track jinx){
                      @if (jinx.char1 === item.ID){
                      @if (getImageForID(jinx.char2)) {
                      <img src={{getImageForID(jinx.char2)}} class="jinxIcon" (error)="onImageError($event,jinx.char2)">
                      }
                      }
                      }
                    </div>
                    <p class="charability" [style.line-height]="abilityLineHeight">{{item.Ability}}</p>

                  </div>
                </div>
                }


                <!-- Demons -->
                <div class="divRow">
                  <div class="divider">
                    <img src="divider.png" class="divPng">
                  </div>
                  <div class="TypeHeader">DEMONS</div>
                </div>

                @for (item of demonsPage1; track item) {
                <div class="charRow">
                  <div class="charImageContainer">
                    <img src={{item.Image}} class="charImage" (error)="onImageError($event,item.ID)">
                  </div>
                  <div class="chartextrow">
                    <div class="charnamerow">
                      <b class="charname" [style.color]='evilCharColor'>{{ item.Name }}</b>
                      @for (jinx of filteredJinxes; track jinx){
                      @if (jinx.char1 === item.ID){
                      @if (getImageForID(jinx.char2)) {
                      <img src={{getImageForID(jinx.char2)}} class="jinxIcon" (error)="onImageError($event,jinx.char2)">
                      }
                      }
                      }
                    </div>
                    <p class="charability" [style.line-height]="abilityLineHeight">{{item.Ability}}</p>

                  </div>
                </div>
                }

              </div>
              <footer class="footer">
                <i>

                  <div class="footerText" style="float:right">
                    * Not the first night
                  </div>
                </i>
              </footer>

            </div>
            }


          </div>
          <!----End Page 1-->



          <!----Page 2 -->
          <div class="print-page" >

            @if(jsonInput){

            <!---- First Night -->
            <div class="nightOrderFirst" style="float:left">
              @for (char of firstOrder;track char){
              @if( char){
              <img src={{getImageForID(char)}} class="nightIcon" (error)="onImageError($event,char)">
              }
              }
              <p class="firstnightText" [style.font-size]="showFirstNightText">FIRST NIGHT</p>
            </div>

            <!---- Other Nights -->
            <div class="nightOrderOther" style="float:right" [style.transform]="invertOtherDeg">
              @for (char of otherOrder;track char){
              @if( char){
              <img src={{getImageForID(char)}} class="nightIcon" (error)="onImageError($event,char)">
              }
              }
              <p class="othernightText" [style.font-size]="showOtherNightText">OTHER NIGHTS</p>
            </div>

            <div class="ScriptNameBottom" [style.color]="scriptNameColor">{{scriptName}}</div>

            <div class="page2main">
              <!----- NPCs Header -->
              @if(filteredJinxes.length > 0 || bootlegger.length > 0 || npcs.length > 0){
              <div class="divRowPage2" style="padding-top:20px">
                <img src="divider.png" class="divPngPage2">
                <div class="HeaderPage2">Fabled & Loric</div>
              </div>
              }

              <!----- Jinxes  -->
              @if (filteredJinxes2.length > 0){
              <div class="npcRow">
                <img src="{{getImageForID('djinn')}}" height="60" (error)="onImageError($event,'djinn')">
                <b class="jinxTitle" [style.color]='fabledColor'>Djinn</b>
              </div>

              @for (jinx of filteredJinxes2; track jinx){
              <div class="jinxRow">
                <b style="padding-right: 30px;"></b>
                <img src={{getImageForID(jinx.char1)}} class="jinxIcon2" (error)="onImageError($event,jinx.char1)">
                <img src={{getImageForID(jinx.char2)}} class="jinxIcon2" (error)="onImageError($event,jinx.char2)">
                <p class="jinxReason">{{jinx.reason}}</p>
              </div>
              }
              }

              <!----Bootlegger -->
              @if (bootlegger.length > 0 || characters.includes("bootlegger")){
              <div class="npcRow">
                <img src="{{getImageForID('bootlegger')}}" height="60" (error)="onImageError($event,'bootlegger')">
                <b class="npcName" [style.color]='loricColor'>Bootlegger</b>
              </div>


              @for (rule of bootlegger; track rule){
              <div class="bootleggerRow">
                <b style="padding-right: 70px;"></b>
                <p>⦁</p>
                <p class="bootleggerRule">{{ rule }}</p>
              </div>
              }
              }

              <!----Stormcatcher -->
              @if (stormcaught && stormcaught != "none"){
              <div class="npcRow">
                <img src="{{getImageForID('stormcatcher')}}" height="60" (error)="onImageError($event,'stormcatcher')">
                <div class="chartextrow">
                  <b class="npcName" [style.color]='loricColor'>Storm Catcher</b>
                  <p class="npcAbility">Name a good character. If in play, they can only die by execution, but evil
                    players
                    learn which player it is.</p>
                </div>
              </div>

              <div class="bootleggerRow">
                <b style="padding-right: 70px;"></b>
                <p style="padding-top:20px">⦁</p>
                <p class="bootleggerRule" style="padding-top:10px">The {{getNameForID(stormcaught)}} is stormcaught.
                </p>
              </div>
              }




              <!---- Other Npcs -->
              @for (item of npcs; track item) {
              @if (
              item.ID !== 'djinn' &&
              item.ID !== 'bootlegger' &&
              (item.ID !== 'stormcatcher' ||
              (!stormcaught || stormcaught === 'none')
              )
              ) {
              <div class="npcRow">
                <div class="image">
                  <img src={{item.Image}} height="60" (error)="onImageError($event,item.ID)">
                </div>
                <div class="chartextrow">
                  @if(item.Team === 'loric') {
                  <b class="npcName" [style.color]='loricColor'>{{item.Name}}</b>
                  }@else{
                  <b class="npcName" [style.color]='fabledColor'>{{item.Name}}</b>
                  }
                  <p class="npcAbility">{{item.Ability}}</p>
                </div>
              </div>
              }
              }

              <!----- Travellers -->
              @if (trav.length > 0){

              <!----- Travellers Header -->
              <div class="divRowPage2" style="padding-top:20px">
                <img src="divider.png" class="divPngPage2">
                <div class="HeaderPage2">Travellers</div>
              </div>

              @for (item of trav; track item) {
              <div class="npcRow">
                <div class="image">
                  <img src={{item.Image}} height="60" (error)="onImageError($event,item.ID)">
                </div>
                <div class="chartextrow">
                  <b class="npcName" [style.color]='travColor'>{{ item.Name }}</b>
                  <p class="npcAbility">{{item.Ability}}</p>
                </div>
              </div>
              }
              }



              <div class="playerCountContainer" #playerCountContainer>

                @if(showPlayerCount){
                <img class="playerCountImage" src=playercount.png>
                }
                @if(showCharBottom){
                <div class="footer2">
                  <div class="charImageContainerBottom">
                    @for(char of townsfolk; track char){
                    <img src={{char.Image}} class="charImageBottom" (error)="onImageError($event,char.ID)">
                    }

                    <img src=divider.png style="opacity: 0;" class="charImageBottom">

                    @for(char of outsiders; track char){

                    <img src={{char.Image}} class="charImageBottom" (error)="onImageError($event,char.ID)">
                    }

                    <img src=divider.png style="opacity: 0;" class="charImageBottom">

                    @for(char of minions; track char){
                    <img src={{char.Image}} class="charImageBottom" (error)="onImageError($event,char.ID)">
                    }

                    <img src=divider.png style="opacity: 0;" class="charImageBottom">

                    @for(char of demons; track char){
                    <img src={{char.Image}} class="charImageBottom" (error)="onImageError($event,char.ID)">
                    }
                  </div>
                </div>
                }
              </div>
            </div>

        


            }

          </div>



        </div>
      </div>
    </div>
  </div>

</main>